<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brownie Bites - Order</title>
  <link rel="stylesheet" href="style.css">
  <script src="firebaseConfig.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js"></script>
</head>
<body>
  <header>
    <h1 style="font-family: Ravie; text-align:center;">üç´ Brownie Bites</h1>
    <p style="text-align:center;">Freshly Baked Happiness</p>
  </header>

  <main>
    <h2>Place Your Order</h2>
    <form id="orderForm">
      <label>Name:</label>
      <input type="text" id="name" required><br><br>

      <label>Phone:</label>
      <input type="text" id="phone" required><br><br>

      <label>Brownie Quantity:</label>
      <input type="number" id="quantity" min="1" required><br><br>

      <label>Payment Method:</label>
      <select id="paymentMethod" required>
        <option value="cod">Cash on Delivery</option>
        <option value="gpay">Google Pay</option>
        <option value="phonepe">PhonePe</option>
        <option value="paytm">Paytm</option>
        <option value="fampay">FamPay</option>
        <option value="bhim">BHIM UPI</option>
      </select><br><br>

      <button type="submit">Proceed</button>
    </form>

    <!-- iOS fallback section -->
    <div id="iosFallback" style="display:none; margin-top:20px; text-align:center;">
      <h3>Scan & Pay</h3>
      <canvas id="qrCanvas"></canvas>
      <p>Or copy UPI ID: <b id="upiText">9380248566@fam</b></p>
      <button onclick="copyUPI()">Copy UPI ID</button>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
  <script>
    const form = document.getElementById("orderForm");
    const iosFallback = document.getElementById("iosFallback");
    const qrCanvas = document.getElementById("qrCanvas");
    const upiId = "9380248566@fam";
    const receiver = "Brownie Bites";

    function generateOrderId() {
      return "BB-" + Math.floor(Math.random() * 1000000);
    }

    function copyUPI() {
      navigator.clipboard.writeText(upiId);
      alert("UPI ID copied: " + upiId);
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const quantity = parseInt(document.getElementById("quantity").value);
      const paymentMethod = document.getElementById("paymentMethod").value;
      const amount = quantity * 50; // price per brownie = 50

      const orderId = generateOrderId();
      alert("Your Order ID: " + orderId);

      // Save order to Firebase
      const db = firebase.database();
      db.ref("orders").push({
        name, phone, quantity, paymentMethod, amount,
        orderId, status: "Pending", paymentStatus: "Unpaid",
        time: new Date().toLocaleString()
      });

      if (paymentMethod === "cod") {
        window.location.href = "thankyou.html?orderId=" + orderId;
        return;
      }

      // UPI deep link
      const upiUrl = `upi://pay?pa=${upiId}&pn=${receiver}&am=${amount}&cu=INR&tn=${orderId}`;

      if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        // iOS fallback ‚Üí show QR & copy option
        iosFallback.style.display = "block";
        const qr = new QRious({
          element: qrCanvas,
          value: upiUrl,
          size: 200
        });
      } else {
        // Try direct open for Android
        window.location.href = upiUrl;
        setTimeout(() => {
          window.location.href = "thankyou.html?orderId=" + orderId;
        }, 4000);
      }
    });
  </script>
</body>
</html>
